# Диаграммы системы
---

**Данные диаграммы корректны только для начальной стадии**

---
## 1. Диаграмма потоков данных (Data Flow Diagram)

Эта диаграмма показывает, как данные перемещаются через систему: от ввода пользователя до обработки, управления состоянием и генерации ответа.

```mermaid
graph TD
    A[Пользователь] -->|Ввод текста| B[Интерфейс ввода]
    B -->|Текст| C[Модуль обработки ввода]
    C -->|Анализ намерения| D[LLM]
    D -->|Выбор действия| E[Модуль управления состоянием]
    E -->|Обновление графа| F[Динамический граф]
    E -->|Запись события| G[Логи событий]
    F -->|Актуальное состояние| H[Модуль генерации ответа]
    G -->|Исторические данные| H
    H -->|Ответ| I[Интерфейс вывода]
    I -->|Текст| A
    J[Персонажи] --> |Текст| A 
    H -.-> |Ответ| J
```

**Описание:**
- Пользователь вводит текст через интерфейс ввода.
- Модуль обработки ввода передает текст в LLM для анализа намерения и выбора действия.
- Модуль управления состоянием обновляет динамический граф и записывает события в логи.
- Модуль генерации ответа использует данные из графа и логов для формирования ответа, который возвращается пользователю через интерфейс вывода.

## 2. Диаграмма классов (Class Diagram)

Эта диаграмма отображает основные классы системы и их взаимосвязи в стандартной UML-нотации, показывая структуру системы.

```mermaid
classDiagram
    class User {
        -String name
        +sendMessage(String message)
    }
    class InputHandler {
        +processInput(String input)
    }
    class LLM {
        +analyzeIntent(String text)
        +selectAction(Intent intent)
    }
    class StateManager {
        +updateDynamicGraph(Action action)
        +logEvent(Event event)
    }
    class DynamicGraph {
        -Map entities
        +addEntity(Entity entity)
        +removeEntity(Entity entity)
        +updateRelation(Relation relation)
    }
    class EventLog {
        -List events
        +addEvent(Event event)
        +searchEvents(Query query)
    }
    class ResponseGenerator {
        +generateResponse(State state, History history)
    }
    class OutputInterface {
        +displayResponse(String response)
    }
    User --> InputHandler : вызывает
    InputHandler --> LLM : использует
    LLM --> StateManager : передает
    StateManager --> DynamicGraph : обновляет
    StateManager --> EventLog : записывает
    DynamicGraph --> ResponseGenerator : предоставляет
    EventLog --> ResponseGenerator : предоставляет
    ResponseGenerator --> OutputInterface : отправляет
```

**Описание:**
- User отправляет сообщения через InputHandler.
- InputHandler обрабатывает ввод и передает его в LLM для анализа и выбора действий.
- StateManager управляет состоянием, обновляя DynamicGraph и записывая события в EventLog.
- ResponseGenerator формирует ответ, используя данные из DynamicGraph и EventLog, и передает его в OutputInterface.

## 3. Диаграмма вариантов использования (Use Case Diagram)

Эта диаграмма демонстрирует основные сценарии использования системы с точки зрения пользователя в стандартной UML-нотации.

```mermaid
graph LR
    subgraph Система
        A[Ввести команду]
        B[Получить ответ]
        C[Просмотреть историю]
        D[Взаимодействовать с агентом]
    end
    U[Пользователь] --> A
    U --> C
    U --> D
    A --> B
    D --> B
```

**Описание:**
- Пользователь может:
  - Вводить команды и получать ответы.
  - Просматривать историю событий.
  - Взаимодействовать с агентом, что также приводит к генерации ответа.
- Основные действия связаны с вводом команд и взаимодействием, которые завершаются получением ответа.

## 4. Диаграмма последовательности (Sequence Diagram)

Эта диаграмма иллюстрирует последовательность взаимодействий между компонентами системы при выполнении команды, например, "Взять меч", в стандартной UML-нотации.

```mermaid
sequenceDiagram
    participant U as Пользователь
    participant I as Интерфейс ввода
    participant P as Модуль обработки ввода
    participant L as LLM
    participant S as Модуль управления состоянием
    participant D as Динамический граф
    participant E as Логи событий
    participant R as Модуль генерации ответа
    participant O as Интерфейс вывода

    U->>I: Ввести команду "Взять меч"
    I->>P: Передать текст команды
    P->>L: Анализировать намерение
    L-->>P: Намерение: взять предмет
    P->>L: Выбрать действие
    L-->>P: Действие: обновить инвентарь
    P->>S: Выполнить действие
    S->>D: Обновить связь "Игрок имеет меч"
    S->>E: Записать событие "Игрок взял меч в 10:00"
    S-->>P: Подтверждение
    P->>R: Сгенерировать ответ
    R->>D: Получить актуальное состояние
    D-->>R: Состояние: игрок имеет меч
    R->>O: Отправить ответ "Вы взяли меч"
    O-->>U: Показать ответ
```

**Описание:**
- Пользователь вводит команду через интерфейс ввода.
- Модуль обработки ввода анализирует текст с помощью LLM, определяет намерение и действие.
- Модуль управления состоянием обновляет граф и логирует событие.
- Модуль генерации ответа формирует ответ на основе актуального состояния и отправляет его пользователю через интерфейс вывода.

## Итог

Эти четыре диаграммы в формате Mermaid представляют систему в стандартных нотациях:
- Диаграмма потоков данных — движение информации.
- Диаграмма классов — структура и взаимосвязи компонентов.
- Диаграмма вариантов использования — функциональные возможности для пользователя.
- Диаграмма последовательности — динамика взаимодействия компонентов.

